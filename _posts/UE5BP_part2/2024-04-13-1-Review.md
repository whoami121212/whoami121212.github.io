---
layout: single
title:  "지금까지 만들어진 내용 정리"
categories: UE5BP-2D
typora-root-url: ../
toc: true
author_profile: false
sidebar:
    nav: "docs"

---

🌝 **<u>공지 사항</u>** 
이 포스트는 인프런의 [입문자를 위한 UE5-Part2. 언리얼 엔진 2D 게임 개발 입문](https://www.inflearn.com/course/%EC%96%B8%EB%A6%AC%EC%96%BC5-%EA%B0%9C%EB%B0%9C%EC%9D%98%EC%A0%95%EC%84%9D-2/dashboard) 강의를 통해 학습한 내용의 요약입니다. 자세한 내용은 해당 강의를 참고해주세요.
{: .notice--primary} 

# 

지금까지 학습해오면서 상황에 따라 이런 저런 코드들을 추가하고 변경했었기 때문에, 현 시점에 어떻게 동작하고 있는지 정리를 한 번 해봄. 

### Level의 구성 
1. 타일맵Tilemap 
- Texture file -> TileSet -> TileMap 세 파일로 변형시켜서 레벨에 배치 
- TileSet에서는 어떤 타일에 Collider를 붙일 수 있는지 설정할 수 있다. 
- 벽 타일에 충돌 설정 후, TileMap에서 두 layer를 구성해서 맵을 만들어 배치함. 
2. Skeleton과 PlayerStart 배치 
- 벽 타일과 겹치지 않게 배치해둔 상태 

### BP_Class의 구성
#### Creature
Object -> Actor -> Pawn -> Character -> PaperCharacter 를 상속받음. 즉 레벨에 배치할 수 있고, 빙의될 수 있으며, 움직임과 관련된 기능이 붙어있고, SkeletalMesh 대신 Flipbook을 쓸 수 있음. 
- 실행 시 CreatureDateTable에서 정보를 받아와서 Hp와 MaxHp 세팅 
- UpdateLogic 에서 state가 move일 때 **Add Movement Input**을 통해서 Direction에 따라 이동
  <img src="/../images/2024-04-13-1-Review/image-20240413073404901.png" alt="image-20240413073404901" style="zoom:67%;" />
- UpdateAnimation 

  - 측면 애니메이션이 하나밖에 없으므로, 먼저 Direction이 Left일 때 **Set Relative Rotation**을 이용해서 Z축을 180도 회전시켜 준다. 그래서 이 이후부터는 up, down, side만 설정하면 됨. 
    <img src="/../images/2024-04-13-1-Review/image-20240413073633549.png" alt="image-20240413073633549" style="zoom:67%;" />
  - 각 상태에 따라서 **Set Flipbook**으로 지정해주는데, 어떤 방향이냐에 따라서 지정할 flipbook의 종류가 다르다. 
    Data에 각 방향/행동에 대한 flipbook을 모두 저장해두고, State/Direction에 따라 각각의 flipbook을 Set 해준다. 
    <img src="/../images/2024-04-13-1-Review/image-20240413073919059.png" alt="image-20240413073919059" style="zoom:67%;" />

  

- BeginAttack 

  - Creature가 공격에 들어가게 되는 경우 실행되는 Custom Event 

  - 상태가 ( Idle, Move )인 경우 Skill 상태로 변경하고, Update Animation실행해서 Attack Flipbook을 재생한다. 
    이후 **Process Attack**(밑에 설명)을 실행한다. 

  - 마지막에는 **Get Flipbook Length**를 통해서 현재 재생되는 Flipbook의 전체 재생시간을 받아오고, 그 시간만큼 **Delay**해서 충분히 재생될 수 있도록 한다. 공격이 종료되면 State를 Move로 변경한다. 

  - **ProcessAttack** 

    - BP_Creature는 Viewport에서 sprite 산하에 3개의 공격범위 충돌체를 가지고 있다. 

    - 각 Direction에 따라서 충돌체를 select 한 다음, **Get Overlapping Actors** 를 통해서 현 시점에 겹치는 BP_Creature들을 Array로 가져온다. 
      <img src="/../images/2024-04-13-1-Review/image-20240413074943330.png" alt="image-20240413074943330" style="zoom:67%;" />

    - 가져온 배열을 for each로 하나하나 처리하는데, 현재 Array의 Element는 Actor Class이므로 BP_Creature로 캐스팅 해준 다음 **OnDamaged** 함수를 실행한다. 이때, OnDamaged는 Damage와 Attacker를 매개변수로 받는데, Damage는 Data에서 가져오고 Attacker는 self(자신)로 설정한다. 

      - **OnDamaged**

        - Damage를 입는 주체가 Attacker가 아닐 때만 실행한다. 

        - (Hp - Damage)를 구해서 Hp를 Set 하는데, 그 수치는 0부터 MaxHp 사이에 있어야 한다(**Clamp**).
          <img src="/../images/2024-04-13-1-Review/image-20240413075703329.png" alt="image-20240413075703329" style="zoom:67%;" />

        - 이후 HpBar 수정을 위해서 현재 Hp와 MaxHp의 비율을 Hp Ratio에 저장한다. UI로 만들어둔 WBP_HpBar는 바로 밑에 설명. 

        - 이 또한 Creature의 component로 붙어있는 HpBarWidget을 가져와서 Widget Object로 불러오고, WBP_HpBar로 캐스팅 해주는 작업이 필요하다. (WBP_HpBar 안에 있는 HpRatio를 가져와서 Set 하기 위해서)

          ![image-20240413080213386](/../images/2024-04-13-1-Review/image-20240413080213386.png)
          
#### WBP_HpBar

